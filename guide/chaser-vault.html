<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Curve Chaser Vault Contract | Kallisto Finance</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Kallisto Finance Documentation">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/kallisto-docs/assets/css/0.styles.1137e04a.css" as="style"><link rel="preload" href="/kallisto-docs/assets/js/app.20c9431b.js" as="script"><link rel="preload" href="/kallisto-docs/assets/js/2.09875b01.js" as="script"><link rel="preload" href="/kallisto-docs/assets/js/11.429ced54.js" as="script"><link rel="prefetch" href="/kallisto-docs/assets/js/10.cec9d980.js"><link rel="prefetch" href="/kallisto-docs/assets/js/12.b773bcf6.js"><link rel="prefetch" href="/kallisto-docs/assets/js/13.0ddaa020.js"><link rel="prefetch" href="/kallisto-docs/assets/js/14.1ad6e38c.js"><link rel="prefetch" href="/kallisto-docs/assets/js/15.8325d13d.js"><link rel="prefetch" href="/kallisto-docs/assets/js/16.ab5d5e7f.js"><link rel="prefetch" href="/kallisto-docs/assets/js/17.551de41c.js"><link rel="prefetch" href="/kallisto-docs/assets/js/18.ccc610d9.js"><link rel="prefetch" href="/kallisto-docs/assets/js/19.9a6e127c.js"><link rel="prefetch" href="/kallisto-docs/assets/js/3.768ae9ff.js"><link rel="prefetch" href="/kallisto-docs/assets/js/4.d0824861.js"><link rel="prefetch" href="/kallisto-docs/assets/js/5.0845eb5d.js"><link rel="prefetch" href="/kallisto-docs/assets/js/6.d70240e2.js"><link rel="prefetch" href="/kallisto-docs/assets/js/7.4a08a835.js"><link rel="prefetch" href="/kallisto-docs/assets/js/8.a7f4b6c3.js"><link rel="prefetch" href="/kallisto-docs/assets/js/9.152b3046.js">
    <link rel="stylesheet" href="/kallisto-docs/assets/css/0.styles.1137e04a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kallisto-docs/" class="home-link router-link-active"><!----> <span class="site-name">Kallisto Finance</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kallisto-docs/guide/abstract.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://kallisto.finance" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Kallisto
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kallisto-docs/guide/abstract.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://kallisto.finance" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Kallisto
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Kallisto</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kallisto-docs/guide/abstract.html" class="sidebar-link">Abstract</a></li><li><a href="/kallisto-docs/guide/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/kallisto-docs/guide/how-to-use.html" class="sidebar-link">Use Kallisto</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Design</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kallisto-docs/guide/scheduler.html" class="sidebar-link">Scheduler</a></li><li><a href="/kallisto-docs/guide/fees.html" class="sidebar-link">Fees</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Logic</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kallisto-docs/guide/chaser-vault.html" aria-current="page" class="active sidebar-link">Smart Contracts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kallisto-docs/guide/chaser-vault.html#swap-routes" class="sidebar-link">Swap Routes</a></li><li class="sidebar-sub-header"><a href="/kallisto-docs/guide/chaser-vault.html#contract-events" class="sidebar-link">Contract Events</a></li><li class="sidebar-sub-header"><a href="/kallisto-docs/guide/chaser-vault.html#key-parametes" class="sidebar-link">Key Parametes</a></li><li class="sidebar-sub-header"><a href="/kallisto-docs/guide/chaser-vault.html#key-constants" class="sidebar-link">Key Constants</a></li><li class="sidebar-sub-header"><a href="/kallisto-docs/guide/chaser-vault.html#interface" class="sidebar-link">Interface</a></li><li class="sidebar-sub-header"><a href="/kallisto-docs/guide/chaser-vault.html#common-internal-functions" class="sidebar-link">Common Internal Functions</a></li><li class="sidebar-sub-header"><a href="/kallisto-docs/guide/chaser-vault.html#common-external-functions" class="sidebar-link">Common External Functions</a></li><li class="sidebar-sub-header"><a href="/kallisto-docs/guide/chaser-vault.html#functions-that-interact-with-curve" class="sidebar-link">Functions that Interact with Curve</a></li><li class="sidebar-sub-header"><a href="/kallisto-docs/guide/chaser-vault.html#emergency-functions" class="sidebar-link">Emergency Functions</a></li></ul></li><li><a href="/kallisto-docs/guide/scripts.html" class="sidebar-link">Scripts</a></li><li><a href="/kallisto-docs/guide/vault-ui.html" class="sidebar-link">Vault UI</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="curve-chaser-vault-contract"><a href="#curve-chaser-vault-contract" class="header-anchor">#</a> Curve Chaser Vault Contract</h1> <p>The <code>curve_apy_vault.vy</code> Vyper smart contract contains all the Kallisto Chaser
Vault functionality. The <a href="https://github.com/kallisto-finance/curve-apy-vault" target="_blank" rel="noopener noreferrer">source code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
is maintained by the Volume Finance team.</p> <h2 id="swap-routes"><a href="#swap-routes" class="header-anchor">#</a> Swap Routes</h2> <p>The Chaser Vault defines swap routes for Curve.
The <code>SwapRoute</code> takes in the addresses of the Curve pools used in the
swapping, and defines the incoming token as well as the token to swap into.</p> <div class="language-js extra-class"><pre class="language-js"><code>struct SwapRoute<span class="token operator">:</span>
    <span class="token literal-property property">swap_pool</span><span class="token operator">:</span> address
    <span class="token literal-property property">j_token</span><span class="token operator">:</span> address
    <span class="token literal-property property">i</span><span class="token operator">:</span> int128 # <span class="token keyword">in</span> token index
    <span class="token literal-property property">j</span><span class="token operator">:</span> int128 # out token index
    <span class="token literal-property property">is_underlying</span><span class="token operator">:</span> bool # <span class="token boolean">true</span> <span class="token keyword">if</span> exchange underlying coins using <span class="token function">exchange_underlying</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token literal-property property">is_crypto_pool</span><span class="token operator">:</span> bool # <span class="token boolean">true</span> <span class="token keyword">if</span> token index <span class="token keyword">in</span> uint256
</code></pre></div><details class="custom-block details"><summary>Parameters</summary> <table><thead><tr><th>Key</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td><code>swap_pool</code></td> <td>address</td> <td>swap pool to use for swap</td></tr> <tr><td><code>j_token</code></td> <td>address</td> <td>out token address from the pool</td></tr> <tr><td><code>i</code></td> <td>int128</td> <td>token index into the pool</td></tr> <tr><td><code>j</code></td> <td>address</td> <td>swap pool to use for swap</td></tr> <tr><td><code>is_underlying</code></td> <td>bool</td> <td>true if exchange underlying coins using exchange_underlying()</td></tr> <tr><td><code>is_crypto_pool</code></td> <td>bool</td> <td>true if token index type is uint256</td></tr></tbody></table></details> <p>The vault locks the balance using the following data type:</p> <div class="language-js extra-class"><pre class="language-js"><code>struct LockedBalance<span class="token operator">:</span>
    <span class="token literal-property property">amount</span><span class="token operator">:</span> int128
    <span class="token literal-property property">end</span><span class="token operator">:</span> uint256
</code></pre></div><blockquote><p>where <code>amount</code> is the token amount locked &amp; <code>end</code> is the end of the lock period.</p></blockquote> <h2 id="contract-events"><a href="#contract-events" class="header-anchor">#</a> Contract Events</h2> <h3 id="erc20-events"><a href="#erc20-events" class="header-anchor">#</a> ERC20 events</h3> <h4 id="transfer-event"><a href="#transfer-event" class="header-anchor">#</a> Transfer event</h4> <p>Transfers from a destination address to a source address.</p> <div class="language-js extra-class"><pre class="language-js"><code>event Transfer<span class="token operator">:</span>
    <span class="token literal-property property">_from</span><span class="token operator">:</span> <span class="token function">indexed</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token literal-property property">_to</span><span class="token operator">:</span> <span class="token function">indexed</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token literal-property property">_value</span><span class="token operator">:</span> uint256

</code></pre></div><h4 id="approval-event"><a href="#approval-event" class="header-anchor">#</a> Approval event</h4> <p>Grants permission to execute logic.</p> <div class="language-js extra-class"><pre class="language-js"><code>event Approval<span class="token operator">:</span>
    <span class="token literal-property property">_owner</span><span class="token operator">:</span> <span class="token function">indexed</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token literal-property property">_spender</span><span class="token operator">:</span> <span class="token function">indexed</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token literal-property property">_value</span><span class="token operator">:</span> uint256
</code></pre></div><h3 id="vault-events"><a href="#vault-events" class="header-anchor">#</a> Vault events</h3> <h4 id="deposit-event"><a href="#deposit-event" class="header-anchor">#</a> Deposit event:</h4> <div class="language-js extra-class"><pre class="language-js"><code>event Deposit<span class="token operator">:</span>
    <span class="token literal-property property">_token</span><span class="token operator">:</span> <span class="token function">indexed</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token literal-property property">_from</span><span class="token operator">:</span> <span class="token function">indexed</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token literal-property property">token_amount</span><span class="token operator">:</span> uint256
    <span class="token literal-property property">vault_balance</span><span class="token operator">:</span> uint256
</code></pre></div><details class="custom-block details"><summary>Parameters</summary> <table><thead><tr><th>Key</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td><code>token_address</code></td> <td>address</td> <td>Address of deposited token</td></tr> <tr><td><code>amount</code></td> <td>uint256</td> <td>deposited amount</td></tr> <tr><td><code>i</code></td> <td>int128</td> <td>deposit token index of the main pool</td></tr> <tr><td><code>swap_route</code></td> <td>SwapRoute[]</td> <td>best swap route on Curve</td></tr> <tr><td><code>min_amount</code></td> <td>uint256</td> <td>minimum amount of vault balance after deposit</td></tr></tbody></table></details> <h4 id="withdrawal-event"><a href="#withdrawal-event" class="header-anchor">#</a> Withdrawal event:</h4> <div class="language-js extra-class"><pre class="language-js"><code>event Withdraw<span class="token operator">:</span>
    <span class="token literal-property property">_token</span><span class="token operator">:</span> <span class="token function">indexed</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token literal-property property">_from</span><span class="token operator">:</span> <span class="token function">indexed</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token literal-property property">token_amount</span><span class="token operator">:</span> uint256
    <span class="token literal-property property">vault_balance</span><span class="token operator">:</span> uint256
</code></pre></div><details class="custom-block details"><summary>Parameters</summary> <table><thead><tr><th>Key</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td><code>token_address</code></td> <td>address</td> <td>withdrawal token address</td></tr> <tr><td><code>amount</code></td> <td>uint256</td> <td>withdrawal vault balance amount (not token amount)</td></tr> <tr><td><code>i</code></td> <td>int128</td> <td>withdrawal token index of the main pool</td></tr> <tr><td><code>swap_route</code></td> <td>SwapRoute[]</td> <td>best swap route on Curve</td></tr> <tr><td><code>min_amount</code></td> <td>uint256</td> <td>minimum amount of withdrawn token from withdraw</td></tr></tbody></table></details> <p>Event to switch the Chaser vault position from the current Curve pool to
the better Curve pool.</p> <div class="language-js extra-class"><pre class="language-js"><code>event Updated<span class="token operator">:</span>
    <span class="token literal-property property">old_pool</span><span class="token operator">:</span> <span class="token function">indexed</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token literal-property property">new_pool</span><span class="token operator">:</span> <span class="token function">indexed</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token literal-property property">_timestamp</span><span class="token operator">:</span> uint256
    <span class="token literal-property property">from_amount</span><span class="token operator">:</span> uint256
    <span class="token literal-property property">to_amount</span><span class="token operator">:</span> uint256
</code></pre></div><details class="custom-block details"><summary>Parameters</summary> <table><thead><tr><th>Key</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td><code>_out_token</code></td> <td>address</td> <td>token to withdraw from current pool</td></tr> <tr><td><code>old_i</code></td> <td>int128</td> <td>withdraw token index of current pool</td></tr> <tr><td><code>swap_route</code></td> <td>SwapRoute[]</td> <td>best swap route on Curve</td></tr> <tr><td><code>new_pool</code></td> <td>address</td> <td>Address of new Curve pool</td></tr> <tr><td><code>new_deposit</code></td> <td>address</td> <td>Address of new Curve deposit contract</td></tr> <tr><td><code>new_i</code></td> <td>int128</td> <td>deposit token index of new Curve Pool</td></tr> <tr><td><code>new_pool_coin_count</code></td> <td>uint8</td> <td>coin count of new Curve Pool</td></tr> <tr><td><code>new_lp_token</code></td> <td>address</td> <td>Address of new Curve LP token</td></tr> <tr><td><code>new_is_crypto_pool</code></td> <td>bool</td> <td>True if new main pool coin index type is uint256</td></tr> <tr><td><code>new_lp_min_amount</code></td> <td>uint256</td> <td>minimum amount of new curve lp token</td></tr></tbody></table></details> <h1 id="erc20-standard-interfaces"><a href="#erc20-standard-interfaces" class="header-anchor">#</a> ERC20 Standard Interfaces</h1> <p>The Chaser Vault Contract implements ERC20 interfaces
and follows the interfaces required to interact with Curve.</p> <h2 id="key-parametes"><a href="#key-parametes" class="header-anchor">#</a> Key Parametes</h2> <table><thead><tr><th>Key</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td><code>name</code></td> <td>public(String[64])</td> <td>token name</td></tr> <tr><td><code>symbol</code></td> <td>public(String[32])</td> <td>token symbol</td></tr> <tr><td><code>balanceOf</code></td> <td>public(HashMap[address, uint256])</td> <td>amount of tokens held by owner</td></tr> <tr><td><code>allowance</code></td> <td>public(HashMap[address, HashMap[address, uint256]])</td> <td>grant approval to transfer to another address</td></tr> <tr><td><code>totalSupply</code></td> <td>public(uint256)</td> <td>total token supply</td></tr> <tr><td><code>paused</code></td> <td>public(bool)</td> <td>if true, pause modifier will halt function's ability to work</td></tr> <tr><td><code>main_pool</code></td> <td>public(address)</td> <td>main curve pool address</td></tr> <tr><td><code>main_pool_coin_count</code></td> <td>public(uint8)</td> <td>coin count</td></tr> <tr><td><code>is_crypto_pool</code></td> <td>public(bool)</td> <td>true if main pool coin index type is uint256</td></tr> <tr><td><code>main_deposit</code></td> <td>public(address)</td> <td>main deposit address for meta pools; (0) for base pools, (1) for lending pools</td></tr> <tr><td><code>main_lp_token</code></td> <td>public(address)</td> <td>the main token in the Curve LP address of main pool</td></tr> <tr><td><code>validators</code></td> <td>public (HashMap[address, bool])</td> <td>validators who can update pool</td></tr> <tr><td><code>admin</code></td> <td>public(address)</td> <td>vault admin</td></tr> <tr><td><code>zap_deposit</code></td> <td>public(address)</td> <td>ZAP deposit pool address that curve provides</td></tr></tbody></table> <h2 id="key-constants"><a href="#key-constants" class="header-anchor">#</a> Key Constants</h2> <table><thead><tr><th>Key</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td><code>MAX_COINS = 8</code></td> <td>constant(uint8)</td> <td>max coins in the Curve pool</td></tr> <tr><td><code>VETH = 0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE</code></td> <td>constant(address)</td> <td>virtual ETH address</td></tr> <tr><td><code>WETH = 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2</code></td> <td>constant(address)</td> <td>wrapped ETH address</td></tr> <tr><td><code>IS_A_POOL_IN_DEPOSIT = 0x0000000000000000000000000000000000000001</code></td> <td>constant(address)</td> <td>use address(1) as deposit address for aave pools</td></tr> <tr><td><code>INIT_ZAP_DEPOSIT = 0xA79828DF1850E8a3A3064576f380D90aECDD3359</code></td> <td>constant(address)</td> <td>initiate ZAP deposit contract address</td></tr> <tr><td><code>TRUE_BYTES32 = 0x0000000000000000000000000000000000000000000000000000000000000001</code></td> <td>constant(bytes32)</td> <td>conversion True into bytes32</td></tr> <tr><td><code>MAX_SWAP = 4</code></td> <td>constant(uint256)</td> <td>max count of swap steps</td></tr></tbody></table> <h2 id="interface"><a href="#interface" class="header-anchor">#</a> Interface</h2> <h3 id="crvpool"><a href="#crvpool" class="header-anchor">#</a> <code>CrvPool</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">CrvPool</span><span class="token operator">:</span>
    def <span class="token function">remove_liquidity_one_coin</span><span class="token punctuation">(</span>token_amount<span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">min_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
    def <span class="token function">exchange</span><span class="token punctuation">(</span>i<span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">j</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">dx</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">min_dy</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> payable
    def <span class="token function">exchange_underlying</span><span class="token punctuation">(</span>i<span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">j</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">dx</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">min_dy</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> payable
</code></pre></div><h3 id="cryptopool"><a href="#cryptopool" class="header-anchor">#</a> <code>CryptoPool</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">CryptoPool</span><span class="token operator">:</span>
    def <span class="token function">exchange</span><span class="token punctuation">(</span>i<span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">j</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">dx</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">min_dy</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> payable
    def <span class="token function">exchange_underlying</span><span class="token punctuation">(</span>i<span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">j</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">dx</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">min_dy</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> payable
    def <span class="token function">remove_liquidity_one_coin</span><span class="token punctuation">(</span>token_amount<span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">min_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
</code></pre></div><h3 id="crvapool"><a href="#crvapool" class="header-anchor">#</a> <code>CrvAPool</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">CrvAPool</span><span class="token operator">:</span>
    def <span class="token function">remove_liquidity_one_coin</span><span class="token punctuation">(</span>token_amount<span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">min_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">use_underlying</span><span class="token operator">:</span> bool<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
</code></pre></div><h3 id="cryptoapool"><a href="#cryptoapool" class="header-anchor">#</a> <code>CryptoAPool</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">CryptoAPool</span><span class="token operator">:</span>
    def <span class="token function">remove_liquidity_one_coin</span><span class="token punctuation">(</span>token_amount<span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">min_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">use_underlying</span><span class="token operator">:</span> bool<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
</code></pre></div><h3 id="crvzapdeposit"><a href="#crvzapdeposit" class="header-anchor">#</a> <code>CrvZapDeposit</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">CrvZapDeposit</span><span class="token operator">:</span>
    def <span class="token function">remove_liquidity_one_coin</span><span class="token punctuation">(</span>_pool<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">token_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">min_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
</code></pre></div><h3 id="cryptozapdeposit"><a href="#cryptozapdeposit" class="header-anchor">#</a> <code>CryptoZapDeposit</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">CryptoZapDeposit</span><span class="token operator">:</span>
    def <span class="token function">remove_liquidity_one_coin</span><span class="token punctuation">(</span>_pool<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">token_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">min_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
</code></pre></div><h3 id="liquiditygauge"><a href="#liquiditygauge" class="header-anchor">#</a> <code>LiquidityGauge</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">LiquidityGauge</span><span class="token operator">:</span>
    def <span class="token function">deposit</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
    def <span class="token function">withdraw</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
</code></pre></div><h3 id="crvminter"><a href="#crvminter" class="header-anchor">#</a> <code>CrvMinter</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">CrvMinter</span><span class="token operator">:</span>
    def <span class="token function">mint</span><span class="token punctuation">(</span>gauge_addr<span class="token operator">:</span> address<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
</code></pre></div><h3 id="erc20"><a href="#erc20" class="header-anchor">#</a> <code>ERC20</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">ERC20</span><span class="token operator">:</span>
    def <span class="token function">balanceOf</span><span class="token punctuation">(</span>_to<span class="token operator">:</span> address<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> uint256<span class="token operator">:</span> view
</code></pre></div><h3 id="wrappedeth"><a href="#wrappedeth" class="header-anchor">#</a> <code>WrappedEth</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">WrappedEth</span><span class="token operator">:</span>
    def <span class="token function">deposit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> payable
    def <span class="token function">withdraw</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
</code></pre></div><h3 id="vecrv"><a href="#vecrv" class="header-anchor">#</a> <code>VeCRV</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">VeCRV</span><span class="token operator">:</span>
    def <span class="token function">increase_unlock_time</span><span class="token punctuation">(</span>_unlock_time<span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
    def <span class="token function">increase_amount</span><span class="token punctuation">(</span>_value<span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
    def <span class="token function">create_lock</span><span class="token punctuation">(</span>_value<span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">_unlock_time</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span> nonpayable
    def <span class="token function">locked</span><span class="token punctuation">(</span>addr<span class="token operator">:</span> address<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> LockedBalance<span class="token operator">:</span> view
    def <span class="token function">withdraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> nonpayable

</code></pre></div><h1 id="vault-initiation"><a href="#vault-initiation" class="header-anchor">#</a> Vault Initiation</h1> <p>The
<a href="https://github.com/kallisto-finance/curve-apy-vault/blob/main/contracts/curve_apy_vault.vy#L106" target="_blank" rel="noopener noreferrer">external initiation function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is called to set up the vault by specifying the <strong>name</strong>,
<strong>token</strong>, <strong>main curve pool</strong>, <strong>main deposit address</strong>, <strong>main pool coin count</strong>,
and the <strong>curve LP token address of the main pool</strong>,</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">__init__</span><span class="token punctuation">(</span>_name<span class="token operator">:</span> String<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">_symbol</span><span class="token operator">:</span> String<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">_main_pool</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_main_deposit</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_main_pool_coin_count</span><span class="token operator">:</span> uint8<span class="token punctuation">,</span> <span class="token literal-property property">_main_lp_token</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_main_liquidity_gauge</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_is_crypto_pool</span><span class="token operator">:</span> bool<span class="token punctuation">)</span><span class="token operator">:</span>
</code></pre></div><h1 id="erc20-common-functions"><a href="#erc20-common-functions" class="header-anchor">#</a> ERC20 Common Functions</h1> <details class="custom-block details"><summary>Function types</summary> <ul><li><strong>@public</strong>: public accessibility</li> <li><strong>@internal</strong>: only the contract itself and contracts deriving from it can access</li> <li><strong>@external</strong>: can only be accessed externally</li> <li><strong>@private</strong>: can be accessed only from the contract itself</li></ul></details> <h2 id="common-internal-functions"><a href="#common-internal-functions" class="header-anchor">#</a> Common Internal Functions</h2> <p>Internal functions are defined for minting, burning, safe transfer and safe transfer
from alternative addresses.</p> <h3 id="mint"><a href="#mint" class="header-anchor">#</a> <code>mint</code></h3> <p>Mints a token specified by its address at a specific amount.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">_mint</span><span class="token punctuation">(</span>_to<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_value</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span>
    assert _to <span class="token operator">!=</span> <span class="token constant">ZERO_ADDRESS</span> # dev<span class="token operator">:</span> zero address
    self<span class="token punctuation">.</span>totalSupply <span class="token operator">+=</span> _value
    self<span class="token punctuation">.</span>balanceOf<span class="token punctuation">[</span>_to<span class="token punctuation">]</span> <span class="token operator">+=</span> _value
    log <span class="token function">Transfer</span><span class="token punctuation">(</span><span class="token constant">ZERO_ADDRESS</span><span class="token punctuation">,</span> _to<span class="token punctuation">,</span> _value<span class="token punctuation">)</span>
</code></pre></div><h3 id="burn"><a href="#burn" class="header-anchor">#</a> <code>burn</code></h3> <p>Burn a token specified by its address at a specific amount.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">_burn</span><span class="token punctuation">(</span>_to<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_value</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span>
    assert _to <span class="token operator">!=</span> <span class="token constant">ZERO_ADDRESS</span> # dev<span class="token operator">:</span> zero address
    self<span class="token punctuation">.</span>totalSupply <span class="token operator">-=</span> _value
    self<span class="token punctuation">.</span>balanceOf<span class="token punctuation">[</span>_to<span class="token punctuation">]</span> <span class="token operator">-=</span> _value
    log <span class="token function">Transfer</span><span class="token punctuation">(</span>_to<span class="token punctuation">,</span> <span class="token constant">ZERO_ADDRESS</span><span class="token punctuation">,</span> _value<span class="token punctuation">)</span>
</code></pre></div><h3 id="safe-approve"><a href="#safe-approve" class="header-anchor">#</a> <code>safe_approve</code></h3> <p>Approves the use of a token by a smart contract.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">safe_approve</span><span class="token punctuation">(</span>_token<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_to</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_value</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token literal-property property">_response</span><span class="token operator">:</span> Bytes<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">raw_call</span><span class="token punctuation">(</span>
        _token<span class="token punctuation">,</span>
        <span class="token function">concat</span><span class="token punctuation">(</span>
            <span class="token function">method_id</span><span class="token punctuation">(</span><span class="token string">&quot;approve(address,uint256)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">convert</span><span class="token punctuation">(</span>_to<span class="token punctuation">,</span> bytes32<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">convert</span><span class="token punctuation">(</span>_value<span class="token punctuation">,</span> bytes32<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        max_outsize<span class="token operator">=</span><span class="token number">32</span>
    <span class="token punctuation">)</span>  # dev<span class="token operator">:</span> failed approve
    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>_response<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token operator">:</span>
        assert <span class="token function">convert</span><span class="token punctuation">(</span>_response<span class="token punctuation">,</span> bool<span class="token punctuation">)</span> # dev<span class="token operator">:</span> failed approve

</code></pre></div><h3 id="safe-transfer"><a href="#safe-transfer" class="header-anchor">#</a> <code>safe_transfer</code></h3> <p>Transfers a token from the vault to another address.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">safe_transfer</span><span class="token punctuation">(</span>_token<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_to</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_value</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token literal-property property">_response</span><span class="token operator">:</span> Bytes<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">raw_call</span><span class="token punctuation">(</span>
        _token<span class="token punctuation">,</span>
        <span class="token function">concat</span><span class="token punctuation">(</span>
            <span class="token function">method_id</span><span class="token punctuation">(</span><span class="token string">&quot;transfer(address,uint256)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">convert</span><span class="token punctuation">(</span>_to<span class="token punctuation">,</span> bytes32<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">convert</span><span class="token punctuation">(</span>_value<span class="token punctuation">,</span> bytes32<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        max_outsize<span class="token operator">=</span><span class="token number">32</span>
    <span class="token punctuation">)</span>  # dev<span class="token operator">:</span> failed transfer
    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>_response<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token operator">:</span>
        assert <span class="token function">convert</span><span class="token punctuation">(</span>_response<span class="token punctuation">,</span> bool<span class="token punctuation">)</span> # dev<span class="token operator">:</span> failed transfer
</code></pre></div><h3 id="safe-transfer-from"><a href="#safe-transfer-from" class="header-anchor">#</a> <code>safe_transfer_from</code></h3> <p>Transfers a token from one address to another address.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">safe_transfer_from</span><span class="token punctuation">(</span>_token<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_from</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_to</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_value</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token literal-property property">_response</span><span class="token operator">:</span> Bytes<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">raw_call</span><span class="token punctuation">(</span>
        _token<span class="token punctuation">,</span>
        <span class="token function">concat</span><span class="token punctuation">(</span>
            <span class="token function">method_id</span><span class="token punctuation">(</span><span class="token string">&quot;transferFrom(address,address,uint256)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">convert</span><span class="token punctuation">(</span>_from<span class="token punctuation">,</span> bytes32<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">convert</span><span class="token punctuation">(</span>_to<span class="token punctuation">,</span> bytes32<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">convert</span><span class="token punctuation">(</span>_value<span class="token punctuation">,</span> bytes32<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        max_outsize<span class="token operator">=</span><span class="token number">32</span>
    <span class="token punctuation">)</span>  # dev<span class="token operator">:</span> failed transfer from
    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>_response<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token operator">:</span>
        assert <span class="token function">convert</span><span class="token punctuation">(</span>_response<span class="token punctuation">,</span> bool<span class="token punctuation">)</span> # dev<span class="token operator">:</span> failed transfer <span class="token keyword">from</span>
</code></pre></div><h2 id="common-external-functions"><a href="#common-external-functions" class="header-anchor">#</a> Common External Functions</h2> <p>These functions are used for accounting-related purposes.</p> <h3 id="transfer"><a href="#transfer" class="header-anchor">#</a> <code>transfer</code></h3> <p>Sends tokens from the vault to another address.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">transfer</span><span class="token punctuation">(</span>_to <span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_value</span> <span class="token operator">:</span> uint256<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> bool<span class="token operator">:</span>
    assert _to <span class="token operator">!=</span> <span class="token constant">ZERO_ADDRESS</span> # dev<span class="token operator">:</span> zero address
    self<span class="token punctuation">.</span>balanceOf<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">-=</span> _value
    self<span class="token punctuation">.</span>balanceOf<span class="token punctuation">[</span>_to<span class="token punctuation">]</span> <span class="token operator">+=</span> _value
    log <span class="token function">Transfer</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> _to<span class="token punctuation">,</span> _value<span class="token punctuation">)</span>
    <span class="token keyword">return</span> True
</code></pre></div><h3 id="transferfrom"><a href="#transferfrom" class="header-anchor">#</a> <code>transferFrom</code></h3> <p>Sends tokens from one address to another address.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">transferFrom</span><span class="token punctuation">(</span>_from <span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_to</span> <span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_value</span> <span class="token operator">:</span> uint256<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> bool<span class="token operator">:</span>
    assert _to <span class="token operator">!=</span> <span class="token constant">ZERO_ADDRESS</span> # dev<span class="token operator">:</span> zero address
    self<span class="token punctuation">.</span>balanceOf<span class="token punctuation">[</span>_from<span class="token punctuation">]</span> <span class="token operator">-=</span> _value
    self<span class="token punctuation">.</span>balanceOf<span class="token punctuation">[</span>_to<span class="token punctuation">]</span> <span class="token operator">+=</span> _value
    self<span class="token punctuation">.</span>allowance<span class="token punctuation">[</span>_from<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">-=</span> _value
    log <span class="token function">Transfer</span><span class="token punctuation">(</span>_from<span class="token punctuation">,</span> _to<span class="token punctuation">,</span> _value<span class="token punctuation">)</span>
    <span class="token keyword">return</span> True
</code></pre></div><h3 id="approve"><a href="#approve" class="header-anchor">#</a> <code>approve</code></h3> <p>Sets the amount as the allowance of spender over the callers tokens.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">approve</span><span class="token punctuation">(</span>_spender <span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_value</span> <span class="token operator">:</span> uint256<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> bool<span class="token operator">:</span>
    assert _value <span class="token operator">==</span> <span class="token number">0</span> or self<span class="token punctuation">.</span>allowance<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">[</span>_spender<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span>
    self<span class="token punctuation">.</span>allowance<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">[</span>_spender<span class="token punctuation">]</span> <span class="token operator">=</span> _value
    log <span class="token function">Approval</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> _spender<span class="token punctuation">,</span> _value<span class="token punctuation">)</span>
    <span class="token keyword">return</span> True
</code></pre></div><h3 id="increaseallowance"><a href="#increaseallowance" class="header-anchor">#</a> <code>increaseAllowance</code></h3> <p>Increases the allowance granted to the spender by the caller.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">increaseAllowance</span><span class="token punctuation">(</span>_spender<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_value</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> bool<span class="token operator">:</span>
    <span class="token literal-property property">allowance</span><span class="token operator">:</span> uint256 <span class="token operator">=</span> self<span class="token punctuation">.</span>allowance<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">[</span>_spender<span class="token punctuation">]</span>
    allowance <span class="token operator">+=</span> _value
    self<span class="token punctuation">.</span>allowance<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">[</span>_spender<span class="token punctuation">]</span> <span class="token operator">=</span> allowance
    log <span class="token function">Approval</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> _spender<span class="token punctuation">,</span> allowance<span class="token punctuation">)</span>
    <span class="token keyword">return</span> True
</code></pre></div><h3 id="decreaseallowance"><a href="#decreaseallowance" class="header-anchor">#</a> <code>decreaseAllowance</code></h3> <p>Decreases the allowance granted to the spender by the caller.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">decreaseAllowance</span><span class="token punctuation">(</span>_spender<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_value</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> bool<span class="token operator">:</span>
    <span class="token literal-property property">allowance</span><span class="token operator">:</span> uint256 <span class="token operator">=</span> self<span class="token punctuation">.</span>allowance<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">[</span>_spender<span class="token punctuation">]</span>
    allowance <span class="token operator">-=</span> _value
    self<span class="token punctuation">.</span>allowance<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">[</span>_spender<span class="token punctuation">]</span> <span class="token operator">=</span> allowance
    log <span class="token function">Approval</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> _spender<span class="token punctuation">,</span> allowance<span class="token punctuation">)</span>
    <span class="token keyword">return</span> True
</code></pre></div><h3 id="collect-management-fee"><a href="#collect-management-fee" class="header-anchor">#</a> <code>collect_management_fee</code></h3> <p>Collects management fee for using Chaser vault.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">collect_management_fee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token literal-property property">fee_amount</span><span class="token operator">:</span> uint256 <span class="token operator">=</span> <span class="token punctuation">(</span>block<span class="token punctuation">.</span>timestamp <span class="token operator">-</span> <span class="token function">convert</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>last_management_fee_epoch<span class="token punctuation">,</span> uint256<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">convert</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>management_fee<span class="token punctuation">,</span> uint256<span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>totalSupply <span class="token operator">/</span> <span class="token constant">ONE_YEAR</span> <span class="token operator">/</span> <span class="token constant">DENOMINATOR</span>
    <span class="token keyword">if</span> fee_amount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span><span class="token function">_mint</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>admin<span class="token punctuation">,</span> fee_amount<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>last_management_fee_epoch <span class="token operator">=</span> <span class="token function">convert</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span> uint40<span class="token punctuation">)</span>

</code></pre></div><h3 id="transfer-admin"><a href="#transfer-admin" class="header-anchor">#</a> <code>transfer_admin</code></h3> <p>Transfer the admin address to another one.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">transfer_admin</span><span class="token punctuation">(</span>_admin<span class="token operator">:</span> address<span class="token punctuation">)</span><span class="token operator">:</span>
# transfer admin permission
    <span class="token literal-property property">old_admin</span><span class="token operator">:</span> address <span class="token operator">=</span> self<span class="token punctuation">.</span>admin
    assert msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> old_admin and _admin <span class="token operator">!=</span> <span class="token constant">ZERO_ADDRESS</span> and old_admin <span class="token operator">!=</span> _admin
    self<span class="token punctuation">.</span>validators<span class="token punctuation">[</span>old_admin<span class="token punctuation">]</span> <span class="token operator">=</span> False
    self<span class="token punctuation">.</span>validators<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> True
    self<span class="token punctuation">.</span>admin <span class="token operator">=</span> _admin
</code></pre></div><h3 id="set-validator"><a href="#set-validator" class="header-anchor">#</a> <code>set_validator</code></h3> <p>Register a new validator or remove a current validator.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">set_validator</span><span class="token punctuation">(</span>_validator<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_value</span><span class="token operator">:</span> bool<span class="token punctuation">)</span><span class="token operator">:</span>
    assert msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> self<span class="token punctuation">.</span>admin
    self<span class="token punctuation">.</span>validators<span class="token punctuation">[</span>_validator<span class="token punctuation">]</span> <span class="token operator">=</span> _value
</code></pre></div><h2 id="functions-that-interact-with-curve"><a href="#functions-that-interact-with-curve" class="header-anchor">#</a> Functions that Interact with Curve</h2> <h3 id="deposit"><a href="#deposit" class="header-anchor">#</a> <code>deposit</code></h3> <h4 id="internal"><a href="#internal" class="header-anchor">#</a> <code>@internal</code></h4> <p>The
<a href="https://github.com/kallisto-finance/curve-apy-vault/blob/7b4d9a4677b434282b19a39cdf7cba2272ec4b14/contracts/curve_apy_vault.vy#L273" target="_blank" rel="noopener noreferrer">internal deposit function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> interacts with
Curve's smart contracts and adds liquidity for one token into a Curve liquidity pool.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">_deposit</span><span class="token punctuation">(</span>main_pool_<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_main_deposit</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_main_pool_coin_count</span><span class="token operator">:</span> uint8<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">in_token</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">in_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span>
</code></pre></div><p>The
<a href="https://github.com/kallisto-finance/curve-apy-vault/blob/7b4d9a4677b434282b19a39cdf7cba2272ec4b14/contracts/curve_apy_vault.vy#L273" target="_blank" rel="noopener noreferrer">internal vote-escrowed deposit function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> interacts with
Curve's smart contracts to add a locked balance as stake into a Curve liquidity pool.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">ve_deposit</span><span class="token punctuation">(</span>liquidity_gauge<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_crv_balance</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span>
</code></pre></div><h4 id="external"><a href="#external" class="header-anchor">#</a> <code>@external</code></h4> <p>The
<a href="https://github.com/kallisto-finance/curve-apy-vault/blob/7b4d9a4677b434282b19a39cdf7cba2272ec4b14/contracts/curve_apy_vault.vy#L477" target="_blank" rel="noopener noreferrer">external deposit function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> works as a
wrapper of the internal deposit and swap functions. It is called when users deposit their
tokens into the vault. Upon being called, it swaps some of the deposit tokens for the tokens
required by the pool, and adds liquidity.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">deposit</span><span class="token punctuation">(</span>token_address<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">amount</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">swap_route</span><span class="token operator">:</span> DynArray<span class="token punctuation">[</span>SwapRoute<span class="token punctuation">,</span> <span class="token constant">MAX_SWAP</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">min_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> uint256<span class="token operator">:</span>
</code></pre></div><h3 id="swap"><a href="#swap" class="header-anchor">#</a> <code>swap</code></h3> <p>The
<a href="https://github.com/kallisto-finance/curve-apy-vault/blob/7b4d9a4677b434282b19a39cdf7cba2272ec4b14/contracts/curve_apy_vault.vy#L396" target="_blank" rel="noopener noreferrer">internal swap function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> interacts with Curve's smart contract and
uses a Curve liquidity pool to swap one token for another. Upon being called,
the function swaps the specified amount of the from_token for the to_token. The
inputs include the Curve liquidity pool's address, the indices for the from_token
and to_token, the addresses for the two tokens, the amount to swap for the from_token,
and whether the pool is a crypto pool.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">_swap</span><span class="token punctuation">(</span>pool<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">j</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">from_token</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">to_token</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">is_underlying</span><span class="token operator">:</span> bool<span class="token punctuation">,</span> <span class="token literal-property property">from_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">is_crypto_pool</span><span class="token operator">:</span> bool<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> uint256<span class="token operator">:</span>
</code></pre></div><h3 id="withdraw"><a href="#withdraw" class="header-anchor">#</a> <code>withdraw</code></h3> <h4 id="internal-2"><a href="#internal-2" class="header-anchor">#</a> <code>@internal</code></h4> <p>The
<a href="https://github.com/kallisto-finance/curve-apy-vault/blob/main/contracts/curve_apy_vault.vy#L448" target="_blank" rel="noopener noreferrer">internal withdraw function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> interacts with the Curve smart contracts directly. It approves
the transaction and removes liquidity in one token. The function requires inputs
specifying the LP tokens and the main pool address to remove liquidity and returned
token address, index, and the amount.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">_withdraw</span><span class="token punctuation">(</span>lp_token<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">_main_pool</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">out_token</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">out_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> uint256<span class="token operator">:</span>
</code></pre></div><h4 id="external-2"><a href="#external-2" class="header-anchor">#</a> <code>@external</code></h4> <p>The
<a href="https://github.com/kallisto-finance/curve-apy-vault/blob/7b4d9a4677b434282b19a39cdf7cba2272ec4b14/contracts/curve_apy_vault.vy#L577" target="_blank" rel="noopener noreferrer">external withdraw function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a wrapper
of the internal withdraw function. It is called when users withdraw liquidity from the vault.
The inputs include withdrawal token address and amount, swap route, and the minimal amount
for swapping. Since the users' withdrawal token may differ from the pool's tokens, a swap
will be applied in that case.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">withdraw</span><span class="token punctuation">(</span>token_address<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">amount</span><span class="token operator">:</span> uint256<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">swap_route</span><span class="token operator">:</span> DynArray<span class="token punctuation">[</span>SwapRoute<span class="token punctuation">,</span> <span class="token constant">MAX_SWAP</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">min_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> uint256<span class="token operator">:</span>
</code></pre></div><h3 id="update-pool"><a href="#update-pool" class="header-anchor">#</a> <code>update_pool</code></h3> <p>The
<a href="https://github.com/kallisto-finance/curve-apy-vault/blob/7b4d9a4677b434282b19a39cdf7cba2272ec4b14/contracts/curve_apy_vault.vy#L616" target="_blank" rel="noopener noreferrer">internal update pool function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
moves the vault's liquidity from one pool to another one. It first removes liquidity
from the old pool and receives one token. Then, it swaps this token for the new token
and adds liquidity to the new pool. This is followed by updating the new LP amount.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">update_pool</span><span class="token punctuation">(</span>_out_token<span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">old_i</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">swap_route</span><span class="token operator">:</span> DynArray<span class="token punctuation">[</span>SwapRoute<span class="token punctuation">,</span> <span class="token constant">MAX_SWAP</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">new_pool</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">new_deposit</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">new_i</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">new_pool_coin_count</span><span class="token operator">:</span> uint8<span class="token punctuation">,</span> <span class="token literal-property property">new_lp_token</span><span class="token operator">:</span> address<span class="token punctuation">,</span> <span class="token literal-property property">new_is_crypto_pool</span><span class="token operator">:</span> bool<span class="token punctuation">,</span> <span class="token literal-property property">new_lp_min_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span><span class="token operator">:</span>
</code></pre></div><h3 id="collect-crv-reward"><a href="#collect-crv-reward" class="header-anchor">#</a> <code>collect_crv_reward</code></h3> <p>The
<a href="https://github.com/kallisto-finance/curve-apy-vault/blob/7b4d9a4677b434282b19a39cdf7cba2272ec4b14/contracts/curve_apy_vault.vy#L679" target="_blank" rel="noopener noreferrer">external CRV reward collector function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> collects the CRV
rewards accumulated through the Chaser vault's Curve pool. Each pool has a unique liquidity gauge.
The function checks the</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">collect_crv_reward</span><span class="token punctuation">(</span>swap_route<span class="token operator">:</span> DynArray<span class="token punctuation">[</span>SwapRoute<span class="token punctuation">,</span> <span class="token constant">MAX_SWAP</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> int128<span class="token punctuation">,</span> <span class="token literal-property property">min_amount</span><span class="token operator">:</span> uint256<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> uint256<span class="token operator">:</span>
</code></pre></div><h2 id="emergency-functions"><a href="#emergency-functions" class="header-anchor">#</a> Emergency Functions</h2> <p>Emergency functions provide security for the vault and can only be executed by the admin.</p> <h3 id="set-main-pool"><a href="#set-main-pool" class="header-anchor">#</a> <code>set_main_pool</code></h3> <p>Used by the admin to set the main pool.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">set_main_pool</span><span class="token punctuation">(</span>_new_pool<span class="token operator">:</span> address<span class="token punctuation">)</span><span class="token operator">:</span>
    assert msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> self<span class="token punctuation">.</span>admin
    self<span class="token punctuation">.</span>main_pool <span class="token operator">=</span> _new_pool
</code></pre></div><h3 id="set-main-deposit"><a href="#set-main-deposit" class="header-anchor">#</a> <code>set_main_deposit</code></h3> <p>Used by the admin to set the main deposit.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">set_main_deposit</span><span class="token punctuation">(</span>_new_deposit<span class="token operator">:</span> address<span class="token punctuation">)</span><span class="token operator">:</span>
    assert msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> self<span class="token punctuation">.</span>admin
    self<span class="token punctuation">.</span>main_deposit <span class="token operator">=</span> _new_deposit
</code></pre></div><h3 id="set-main-pool-coin-count"><a href="#set-main-pool-coin-count" class="header-anchor">#</a> <code>set_main_pool_coin_count</code></h3> <p>Used by the admin to set the pool coin count.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">set_main_pool_coin_count</span><span class="token punctuation">(</span>_new_main_pool_coin_count<span class="token operator">:</span> uint8<span class="token punctuation">)</span><span class="token operator">:</span>
    assert msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> self<span class="token punctuation">.</span>admin
    self<span class="token punctuation">.</span>main_pool_coin_count <span class="token operator">=</span> _new_main_pool_coin_count
</code></pre></div><h3 id="set-is-crypto-pool"><a href="#set-is-crypto-pool" class="header-anchor">#</a> <code>set_is_crypto_pool</code></h3> <p>Used by the admin to set the new Curve pool.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">set_is_crypto_pool</span><span class="token punctuation">(</span>_new_is_crypto_pool<span class="token operator">:</span> bool<span class="token punctuation">)</span><span class="token operator">:</span>
    assert msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> self<span class="token punctuation">.</span>admin
    self<span class="token punctuation">.</span>is_crypto_pool <span class="token operator">=</span> _new_is_crypto_pool
</code></pre></div><h3 id="set-main-lp-token"><a href="#set-main-lp-token" class="header-anchor">#</a> <code>set_main_lp_token</code></h3> <p>Used by the admin to set the main liquidity pool token.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">set_main_lp_token</span><span class="token punctuation">(</span>_new_main_lp_token<span class="token operator">:</span> address<span class="token punctuation">)</span><span class="token operator">:</span>
    assert msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> self<span class="token punctuation">.</span>admin
    self<span class="token punctuation">.</span>main_lp_token <span class="token operator">=</span> _new_main_lp_token
</code></pre></div><h3 id="set-main-liquidity-gauge"><a href="#set-main-liquidity-gauge" class="header-anchor">#</a> <code>set_main_liquidity_gauge</code></h3> <p>Used by admin to se the main liquidity gauge.</p> <blockquote><p><code>LiquidityGauge</code> measures liquidity provided by users over time,
in order to distribute CRV and other rewards from staking.</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">set_main_liquidity_gauge</span><span class="token punctuation">(</span>_new_main_liquidity_gauge<span class="token operator">:</span> address<span class="token punctuation">)</span><span class="token operator">:</span>
    assert msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> self<span class="token punctuation">.</span>admin and self<span class="token punctuation">.</span>main_liquidity_gauge <span class="token operator">==</span> <span class="token constant">ZERO_ADDRESS</span>
    <span class="token literal-property property">lp_token</span><span class="token operator">:</span> address <span class="token operator">=</span> self<span class="token punctuation">.</span>main_lp_token
    <span class="token literal-property property">amount</span><span class="token operator">:</span> uint256 <span class="token operator">=</span> <span class="token constant">ERC20</span><span class="token punctuation">(</span>lp_token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span><span class="token function">safe_approve</span><span class="token punctuation">(</span>lp_token<span class="token punctuation">,</span> _new_main_liquidity_gauge<span class="token punctuation">,</span> amount<span class="token punctuation">)</span>
    <span class="token function">LiquidityGauge</span><span class="token punctuation">(</span>_new_main_liquidity_gauge<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deposit</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>liquidity <span class="token operator">=</span> amount
    self<span class="token punctuation">.</span>main_liquidity_gauge <span class="token operator">=</span> _new_main_liquidity_gauge
</code></pre></div><h3 id="set-zap-deposit"><a href="#set-zap-deposit" class="header-anchor">#</a> <code>set_zap_deposit</code></h3> <p>Used by the admin to set the ZAP deposit.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">set_zap_deposit</span><span class="token punctuation">(</span>_new_zap_deposit<span class="token operator">:</span> address<span class="token punctuation">)</span><span class="token operator">:</span>
    assert msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> self<span class="token punctuation">.</span>admin
    self<span class="token punctuation">.</span>zap_deposit <span class="token operator">=</span> _new_zap_deposit
</code></pre></div><h3 id="pause"><a href="#pause" class="header-anchor">#</a> <code>pause</code></h3> <p>Used by the admin to pause all functionality.</p> <div class="language-js extra-class"><pre class="language-js"><code>def <span class="token function">pause</span><span class="token punctuation">(</span>_paused<span class="token operator">:</span> bool<span class="token punctuation">)</span><span class="token operator">:</span>
    assert msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> self<span class="token punctuation">.</span>admin
    self<span class="token punctuation">.</span>paused <span class="token operator">=</span> _paused
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/kallisto-docs/guide/fees.html" class="prev">
        Fees
      </a></span> <span class="next"><a href="/kallisto-docs/guide/scripts.html">
        Scripts
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/kallisto-docs/assets/js/app.20c9431b.js" defer></script><script src="/kallisto-docs/assets/js/2.09875b01.js" defer></script><script src="/kallisto-docs/assets/js/11.429ced54.js" defer></script>
  </body>
</html>
